# Command Injection Vulnerability in Firmware Update Process of DLink DAP-2695

## Affected Product
DLink DAP-2695 (firmware version: v2.00RC131)

## Overview

During the firmware update process, there is a command injection vulnerability in function upload_certificate() of program httpd. The private key file and CA file is uploaded by the users through pcVar1 where param3 is the user input. Then function FUN_00416dd8 executes system command to commit private key, certificate or delete old certificate. However FUN_00416dd8 takes pcVar1 as the parameter of system execution function and there is no verification on pcVar1. Once the hackers control pcVar1, they could inject malicious command in pcVar1. The malicious command would be passed to system execution function through parameters. This issue in the firmware update process of Dlink DAP-2695(firmware version:v2.00RC131) allows attackers to execute arbitrary code or cause denial of service via constructing a malicious command and injecting it into pcVar1.


During the firmware update process, there is a command injection vulnerability in function check_upgrad() of program httpd. The upload_file is uploaded by the users, which makes it become user input. Then, it is passed to function FUN_0041e620() as the first parameter. 

The exploit chain of command injection vulnerability is Upload_file -> param1-> _ptr -> param3 -> snprintf(acStack_134, 0xff, “unmount %s”, param3) -> system(acStack_134)


<img width="468" height="205" alt="image" src="https://github.com/user-attachments/assets/9508c798-1aae-46f1-b99a-13c1f9aee209" />
<img width="468" height="287" alt="image" src="https://github.com/user-attachments/assets/368f816a-73f5-4156-94fe-18a538f480dc" />
<img width="456" height="319" alt="image" src="https://github.com/user-attachments/assets/5a17ac0c-3ab8-464c-8480-135f8506d6ca" />


